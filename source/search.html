<!DOCTYPE html>
<html>
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
      <title>Поиск и индексирование в Lingvo</title>
      <link href="files/style.css" rel="stylesheet">
</head>

<body>
<div id="header">Справочник по DSL</div>
<div id="main">
<h1>Поиск и индексирование в Lingvo</h1>
<p>Эта тема имеет непосредственное отношение к пониманию действия тэгов поисковой обработки <span class="code">[ex]</span>, <span class="code">[com]</span>, <span class="code">[trn]</span> и <span class="code">[!trs]</span>.</p>
<p>Поскольку язык DSL разрабатывался специалистами ABBYY специально для использования в Lingvo, его устройство тесно связано с особенностями работы этой программы. Одной из таких особенностей является организация поиска слов по тексту словарей и связанный с этим процесс индексирования.</p>
<p>Одним из основных и бесспорных преимуществ электронных словарей в сравнении с бумажными является возможность быстрого (а лучше мгновенного) поиска по содержимому. Отметим, что речь при этом идёт как правило не об одном словаре, а о десятках, иногда даже сотнях. И скорость при осуществлении данной задачи является фактором ключевым, хотя и не единственным. Рассмотрим, как этот процесс организован в Lingvo.</p>
<p>При подключении к Lingvo нового словаря программа автоматически запускает процесс индексирования, во время которого происходит анализ содержимого словаря и составляется индекс&nbsp;&mdash; полный компактный перечень всех входящих в словарь слов. Построение индекса требует времени, но выполняется оно единожды. При последующих поисковых запросах слово ищется уже не в словаре, а в индексе, благодаря чему и достигается высокая скорость поиска.</p>
<p>Индекс записывается в файлы <span class="code_names">*.trs</span> и располагается в пользовательской папке <span class="code_names">..\Application Data\Local\ABBYY\Lingvo</span>. При добавлении каждого нового словаря индекс пополняется и, соответственно, растёт его размер и кол-во файлов. Очевидно, что для того, чтобы размер не увеличивался напрасно, при создании индекса в него должны включаться только полезные данные (а бесполезные исключаться). Регулирование этого процесса предусмотрено на уровне DSL.</p>
<p>Зоны текста, которые обрабатываются или игнорируются Lingvo при составлении индекса, размечаются в DSL при помощи тэгов. Т.о. по отношению к индексу тэги могут быть включающими и исключающими.</p>
<p><strong>Исключающими</strong> из индекса являются тэги: прежде всего <span class="code">[!trs]</span>, затем <span class="code">[p]</span>, <span class="code">[ref]</span>, <span class="code">&lt;&lt;&hellip;&gt;&gt;</span>, <span class="code">[url]</span>, <span class="code">[s]</span>, <span class="code">[video]</span>. Из перечисленных только у первого <span class="code">[!trs]</span> функция исключения из индекса&nbsp;&mdash; главная и единственная, у остальных она не единственна и побочна.</p>
<p><strong>Включающими</strong> в индекс являются тэги: <span class="code">[trn]</span>, <span class="code">[ex]</span> и <span class="code">[com]</span>. Кроме того в индекс в обязательном порядке попадают все словарные заголовки.</p>
<p>Механизм влияния включающих тэгов на операцию индексирования рассмотрим на простом примере. Создадим тестовый DSL словарик из одной карточки:</p>
<p style="text-align:center;"><img src="images/index_dsl.png"></p>
<p>Мы видим, что часть текста находится в зоне действия включающих тэгов <span class="code">[trn]</span>, <span class="code">[ex]</span> и <span class="code">[com]</span>&nbsp;&mdash; этот текст должен быть включен в состав индекса. Один фрагмент находится за пределами включающего <span class="code">[trn]</span>, а другой обрамлен исключающим <span class="code">[!trs]</span>&nbsp;&mdash; этот текст в индекс попасть не должен. Теперь проверим так ли это на практике. Компилируем словарик, подключаем его к Lingvo и выполняем поисковый запрос по слову «гвоздь».</p>
<p style="text-align:center;"><img src="images/index_g.png"></p>
<p>Как видим, результаты поиска распределены по категориям: заголовки, переводы, примеры и комментарии. Именно на эти категории были нацелены наши включающие тэги: <span class="code">[trn]</span>&nbsp;&mdash; для переводов, <span class="code">[ex]</span>&nbsp;&mdash; для примеров, <span class="code">[com]</span>&nbsp;&mdash; для комментариев, а заголовки проиндексировались без дополнительной разметки. Искомое слово найдено во всех четырёх категориях. Сравниваем с исходным DSL: действительно, «гвоздь» встречается как в области действия всех включающих тэгов, так и в заголовках. Теперь поищем слово «фуражка».</p>
<p style="text-align:center;"><img src="images/index_f.png"></p>
<p>Как видим, слово нашлось только в категории примеров. Всё правильно: в заголовках его нет, в зону переводов <span class="code">[trn]</span> оно не попало, а из зоны комментариев <span class="code">[com]</span> мы его исключили при помощи <span class="code">[!trs]</span>.</p>
<p>Итак, пример наглядно продемонстрировал нам следующее:</p>
<ol>
  <li>В состав индекса включаются заголовки и текст, находящийся в зоне действия включающих тэгов.</li>
  <li>Каждый из включающих тэгов образует отдельную категорию в индексе.</li>
  <li>В состав индекса не попадает текст, находящийся за пределами зоны действия включающих тэгов, а также текст, занесённый в зону действия исключающих тэгов.</li>
  <li>Механизм поиска находит только те слова, которые попали в состав индекса.</li>
</ol>
<p>При помощи аккуратной разметки мы добились того, что в индекс вошли только полезные данные, следовательно его объём стал максимально экономичным, а состав&nbsp;&mdash; максимально эффективным. Однако такая подготовка DSL требует от составителя специальных технических навыков, особенно при обработке словарей большого объёма. На сотнях или тысячах строк необходимо правильно расставить тэги и ничего не упустить, иначе неразмеченный текст станет недоступным для поиска в Lingvo. Не каждому пользователю по силам подобная задача. Для таких случаев в Lingvo предусмотрен другой способ разметки&nbsp;&mdash; <strong>автоматический</strong>. Как это происходит, мы рассмотрим на другом примере.</p>
<p>Создадим тестовый словарик, аналогичный предыдущему по строению, но, для наглядности, на английском языке:</p>
<p style="text-align:center;"><img src="images/index_en.png"></p>
<p>Теперь отконвертируем его в формат LSD при помощи DSL Compiler, предварительно включив в компиляторе опцию <abbr title="Автоматически добавлять разметку, необходимую для поиска по содержимому карточек словаря">Create dictionary ready for indexing</abbr>. Полученный LSD откроем в hex-редакторе и посмотрим, что внутри.</p>
<p style="text-align:center;"><img src="images/index_hex.png"></p>
<p>Как видим, в начале и в конце статьи появились дескрипторы нового тэга, которого не было в исходном DSL (на снимке они подчёркнуты пурпурными линиями). Его имя <span class="code">[trn1]</span> почти совпадает с именем уже известного нам <span class="code">[trn]</span>, отличаясь от него всего единицей. В чём же их существенное сходство и различие?</p>
<p>Недокументированный тэг <span class="code">[trn1]</span> подобно своему родственнику <span class="code">[trn]</span> причисляет текст к поисковой категории <abbr title="Переводы">Translations</abbr>. Отличается же он тем, что предназначен только для автоматической разметки, т.е. его нельзя поместить, как <span class="code">[trn]</span>, в текст DSL самостоятельно &nbsp;&mdash; компилятор опротестует подобную попытку. Разница же в имени сделана для того, чтобы родственники не конфликтовали друг с другом. Мы уже знаем о <a href="tag_system.html#comments">запрете DSL</a> размещать одинаковые тэги в зоне действия друг друга. Если бы мы в своём DSL расставили <span class="code">[trn]</span> вручную, а затем во время компилирования включили бы ещё автоматическую разметку, наши <span class="code">[trn]</span> попали бы в зону действия <span class="code">[trn]</span> расставленных компилятором, и это привело бы к невозможности создать полноценный LSD. Во избежание подобных конфликтов тэгу автоматической разметки присвоено отличающееся имя&nbsp;&mdash; <span class="code">[trn1]</span>.</p>
<p>Итак, суммируем полученные знания и наблюдения:</p>
<ol>
  <li>При автоматической разметке тэги индексирования помещаются в начало и конец каждой словарной статьи. Т.о. весь текст словаря становится доступен для полнотекстового поиска.</li>
  <li>Автоматическая разметка причисляет текст к поисковой категории <abbr title="Переводы">Translations</abbr>.</li>
  <li>Современная автоматическая разметка, выполняемая в Lingvo x6 (и последних версиях x5), не порождает конфликтов с другими тэгами DSL.</li>
  <li>Для создания автоматической разметки используется недокументированный тэг <span class="code">[trn1]</span>. Этот тэг не может быть использован никаким иным, кроме автоматики, способом.</li>
  <li>Автоматическая разметка менее экономична и аккуратна по сравнению с разметкой вручную, но зато не требует от составителя словаря специальных технических знаний и навыков.</li>
</ol>
</div>
<div id="footer">
<p>Справочник по DSL • <a href="changes.html">Версия 0.9.6 beta</a> • 05.07.2023</p>
<p>Public Domain 2023 yozhic. Свободный контент. Все права открыты и неограничены. Никаких гарантий и ответственности.</p>
</div>
</body>
</html>
